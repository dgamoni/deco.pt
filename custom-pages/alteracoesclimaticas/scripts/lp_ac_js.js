if(typeof templateLocation==="undefined"){var templateLocation=""}if(typeof siteLocation==="undefined"){var siteLocation="/"}if(typeof lang==="undefined"){var lang="pt"}var $municipalities_selectize;var captchaDone=false;jQuery(document).ready(function($){"use strict";$("img.inline-svg").each(function(){var $img=$(this);var imgURL=$img.attr("src");$.get(imgURL,function(data){var $svg=$(data).find("svg");$img.replaceWith($svg)},"xml")});var hasEvaluated=false;var cookieRAEVArray_init={ra:{},ev:[]};var cookieRAEVArray;try{cookieRAEVArray=JSON.parse(getCookie("ac_u_ra_ev"))}catch(ex){cookieRAEVArray=null}if(typeof cookieRAEVArray!=="object"||cookieRAEVArray===null){cookieRAEVArray=cookieRAEVArray_init}$(".map-municipalities").each(function(){$(this).parent().attr("data-id",$(this).attr("data-id"))});$(".map-districts [data-id]").click(function(){var districtID=$(this).attr("data-id");var districtTitle=$(this).attr("data-title");if($(this).hasClass("selected")){return false}$(".map-districts [data-id]").removeClass("selected");$(".map-municipalities [data-municipality-id]").removeClass("selected");$(this).addClass("selected");$(".map-districts").addClass("zoom-smaller");hideDetailsBox();if($(".map-municipalities-block .map-svg.zoom-show").length>0){$(".map-municipalities-block .map-svg").removeClass("zoom-show");$(".map-municipalities-block .map-svg").parent().parent().css("height","");$(".map-municipalities-item").removeClass("stack-up");showMunicipality(districtID)}else{showMunicipality(districtID)}});function showMunicipality(districtID){var thisMapContainer=$(".map-municipalities-item[data-id='"+districtID+"']");var thisMap=$(".map-municipalities-block .map-svg[data-id='"+districtID+"']");thisMapContainer.addClass("stack-up");thisMap.addClass("zoom-show");resizeMunicipalityWrapper();if(document.body.clientWidth<837){scrollTo($("#municipalities_section"),800,260)}}function resizeMunicipalityWrapper(){var thisMapWrapper=$(".map-municipalities-item.stack-up");var thisMapHeight="";var bodyWidth=document.body.clientWidth;if(bodyWidth<837){thisMapHeight=$(".map-svg",thisMapWrapper).height()+"px"}else{thisMapHeight=""}thisMapWrapper.parent().css("height",thisMapHeight)}$(".map-municipalities > g > path[data-municipality-id], .map-municipalities > g > g[data-municipality-id]").click(function(){if($(this).attr("data-municipality-id")!=undefined){var theElement=$(this);if($(this).hasClass("selected")){return false}if($("#plan-details.zoom-show").length>0){$("#plan-details").removeClass("zoom-show").delay(400).queue(function(){getDetailsForMunicipality(theElement);$(this).dequeue()})}else{getDetailsForMunicipality(theElement)}}});function getDetailsForMunicipality(theElement){var theElement=theElement;var thisMap=theElement.closest(".map-municipalities");var districtID=thisMap.attr("data-id");var districtAlias=thisMap.attr("data-district");var municipality_id=theElement.attr("data-municipality-id");var municipalityTitle=theElement.attr("data-title");hideRatingThanks();$(".map-municipalities [data-municipality-id]").removeClass("selected");theElement.addClass("selected");$("#plan-details").attr({"data-district-id":districtID,"data-municipality-id":municipality_id,"data-municipality-title":municipalityTitle});$("#plan-details .plan-details-title").text("Município: "+municipalityTitle);var plan_details_lines_array={impact:"1",measures:"2",ecofootprint:"3",adaptation_plan:"4",available_site:"5"};for(var i in plan_details_lines_array){var thisValue=plan_details_json[municipality_id][plan_details_lines_array[i]];var thisValue_text="";switch(thisValue){case"1":thisValue_text="Sim";break;case"0":thisValue_text="Não";break;default:thisValue_text="Site não disponível";thisValue="na"}$(".plan-details-lines [data-item='"+i+"'] .plan-status").removeClass("status-0 status-1 status-na");$(".plan-details-lines [data-item='"+i+"'] .plan-status").addClass("status-"+thisValue).text(thisValue_text).attr("title",thisValue_text)}$(".global-evaluation-status span").removeClass();var thisGlobalEvaluation=plan_details_json[municipality_id][6];var thisGlobalEvaluation_text="";switch(thisGlobalEvaluation){case"1":thisGlobalEvaluation_text="Pode Melhorar";break;case"2":thisGlobalEvaluation_text="Satisfatória";break;case"3":thisGlobalEvaluation_text="Boa";break;default:thisGlobalEvaluation_text="N/A"}$(".global-evaluation-status span").addClass("evaluation-"+thisGlobalEvaluation).text(thisGlobalEvaluation_text);doGetRating(municipality_id);if(cookieRAEVArray.ev.includes(municipality_id)||hasEvaluated){$(".rating-result-box-evaluate, .interactive-participate").hide()}else{$(".rating-result-box-evaluate, .interactive-participate").show()}selectTheMunicipalitiesDropdown();$("#plan-details").addClass("zoom-show");$(".plan-details-wrapper").addClass("show-details-mobile");if(document.body.clientWidth<1137){scrollTo($("#municipalities_details_section"),800,260)}if(!(municipality_id in cookieRAEVArray.ra)){$("ul#interactive-rating").addClass("can-rate")}else{$("ul#interactive-rating").removeClass("can-rate");var thisRating=cookieRAEVArray.ra[municipality_id];$("#interactive-rating").attr("data-rating-user",thisRating).delay(400).queue(function(){showRatingThanks();$(this).dequeue()})}return this}function hideDetailsBox(){$("#plan-details").removeClass("zoom-show");$(".plan-details-wrapper").removeClass("show-details-mobile")}$(document).on("mouseenter","ul#interactive-rating.can-rate li",function(event){var thisRating=$(this).attr("data-rating");for(var i=thisRating;i>0;i--){$("ul#interactive-rating.can-rate li[data-rating='"+i+"']").addClass("hover")}});$(document).on("mouseleave","ul#interactive-rating.can-rate li",function(event){$("ul#interactive-rating.can-rate li").removeClass("hover")});$(document).on("click","#interactive-rating.can-rate li",function(event){event.preventDefault();$("ul#interactive-rating.can-rate li").removeClass("hover");$("ul#interactive-rating").removeClass("can-rate");var municipality_id=$("#plan-details").attr("data-municipality-id");var municipality_title=$("#plan-details").attr("data-municipality-title");var thisRating=$(this).attr("data-rating");var ratingResult=performRating("set",municipality_id,municipality_title,thisRating);cookieRAEVArray.ra[municipality_id]=thisRating;storeRA_EV_cookie();$("#interactive-rating").attr("data-rating-user",thisRating);doGetRating(municipality_id);showRatingThanks()});function performRating(rating_type,municipality_id,municipality_title,rating){var request;var theResponse="";if(request){request.abort()}request=$.ajax({url:siteLocation+"includes/ra.php",type:"post",async:false,data:{rating_type:rating_type,municipality_id:municipality_id,municipality_title:municipality_title,rating:rating}});request.done(function(response,textStatus,jqXHR){theResponse=response});request.fail(function(jqXHR,textStatus,errorThrown){console.error("The following error occurred: "+textStatus,errorThrown)});return theResponse}function doGetRating(municipality_id){$("ul#interactive-rating li").removeClass("active");var thisRating=performRating("get",municipality_id,"","");for(var i=thisRating;i>0;i--){$("ul#interactive-rating li[data-rating='"+i+"']").addClass("active")}}function showRatingThanks(){var userRating=$("#interactive-rating").attr("data-rating-user");var ratedPosition=$("#interactive-rating li[data-rating='"+userRating+"']").position().left;$(".rating-result-box-tip").css("left",ratedPosition+"px");$(".rating-result-block").show();$("#plan-details").show().delay(100).queue(function(){$(".rating-result-block").addClass("zoom-show");$(this).dequeue()})}function hideRatingThanks(){$(".rating-result-block").hide().removeClass("zoom-show")}for(var i in municipalities_json){var municipalities_key=i;var municipalities_val=municipalities_json[i];var thisOptions={value:municipalities_val[1],text:municipalities_val[1],"data-id":municipalities_val[0],"data-data":'{"id": "'+municipalities_val[0]+'"}'};if(cookieRAEVArray.ev.includes(municipalities_val[0])){thisOptions["disabled"]="disabled"}$("#select_municipalities").append($("<option>",thisOptions))}var $municipalities_selectize=$("#select_municipalities").selectize({dropdownParent:"body",render:{option:function(data,escape){return'<div data-id="'+data.id+'" class="option">'+data.text+"</div>"}}});contactsFormFieldsHandler();$(".bt-interactive-participate").on("click",function(event){event.preventDefault();scrollTo($("#contacts-form-wrapper"),1e3,260)});function selectTheMunicipalitiesDropdown(){var theMunicipality=$("#plan-details").attr("data-municipality-title");$municipalities_selectize[0].selectize.setValue(theMunicipality)}$(".bt-send-contacts-form").on("click",function(event){event.preventDefault();$("#contacts-form .wpcf7-not-valid-tip").remove();$("#contacts-form").removeClass("invalid failed");$(".wpcf7-response-output").hide();var formValid=true;$("#contacts-form [aria-required='true']").each(function(){var thisParent=$(this).parent();if($(this).val()===""){var errorTipContent='<span class="wpcf7-not-valid-tip" aria-hidden="true">O campo é obrigatório.</span>';thisParent.append(errorTipContent);formValid=false}if($(this).attr("name")==="email"&&!validateEmail($(this).val())&&$(this).val()!==""){$(this).after('<span class="wpcf7-not-valid-tip" aria-hidden="true">O endereço de email é inválido.</span>');formValid=false}});if(!formValid){$("#contacts-form").addClass("invalid");$(".wpcf7-response-output").html("Um ou mais campos com erros. Por favor, verifique e tente de novo.").show()}if(formValid){disableFormFields();grecaptcha.ready(function(){grecaptcha.execute("6LevCcseAAAAAH-AsYicDrc9iNJFkA591RUCEl2U",{action:"validate_captcha"}).then(function(token){$("#g-recaptcha-response").val(token);$.when(validateRecaptchaServer()).done(function(theResponse){if(theResponse==="success"){processFormAfterValid()}else{$("#contacts-form").addClass("failed");$(".wpcf7-response-output").html("Ocorreu um erro, por favor tente mais tarde.").show();enableFormFields()}}).fail(function(theResponse){})})})}});function validateEmail(email){var re=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return re.test(String(email).toLowerCase())}function contactsFormFieldsHandler(){$(document).on("change",".consent",function(){if($(this).is(":checked")){$(".bt-send-contacts-form").prop("disabled",false)}else{$(".bt-send-contacts-form").prop("disabled",true)}});$(document).on("change","#contacts-form [aria-required='true']",function(){$("#contacts-form").removeClass("invalid");$(".wpcf7-response-output").hide();$(this).siblings(".wpcf7-not-valid-tip").remove()})}function disableFormFields(){$("#contacts-form").removeClass("invalid");$(".wpcf7-response-output").hide();$("#contacts-form .wpcf7-form-control").prop("disabled",true);$municipalities_selectize[0].selectize.disable();$("#contacts-form .wpcf7-spinner").css("visibility","visible")}function enableFormFields(){$("#contacts-form .wpcf7-form-control").prop("disabled",false);$municipalities_selectize[0].selectize.enable();$("#contacts-form .wpcf7-spinner").css("visibility","hidden")}function processFormAfterValid(){enableFormFields();var selectedValue=$municipalities_selectize.val();var $selectedOption=$municipalities_selectize[0].selectize.getOption(selectedValue);$("#contacts-form [name='id_municipality']").val($selectedOption.data("id"));cookieRAEVArray.ev.push($("#contacts-form [name='id_municipality']").val());storeRA_EV_cookie();doSendContactsForm();disableFormFields()}function doSendContactsForm(){$.when(sendContactsForm()).done(function(theResponse){var sendResult=theResponse;$("#contacts-form").addClass("sent");$(".wpcf7-response-output").html("Obrigado pela sua mensagem.").show();$("#contacts-form .wpcf7-spinner").css("visibility","hidden");$(".bt-send-contacts-form").remove();hasEvaluated=true}).fail(function(theResponse){$("#contacts-form").addClass("failed");$(".wpcf7-response-output").html("Ocorreu um erro. Por favor tente mais tarde.").show();$("#contacts-form .wpcf7-form-control").prop("disabled",false);$("#contacts-form .wpcf7-spinner").css("visibility","hidden")})}function sendContactsForm(){var request;var theResponse="";if(request){request.abort()}var form_data=$("#contacts-form").serializeObject();request=$.ajax({url:siteLocation+"includes/co.php",type:"post",data:form_data});request.done(function(response,textStatus,jqXHR){});request.fail(function(jqXHR,textStatus,errorThrown){console.error("The following error occurred: "+textStatus,errorThrown)});return request}function validateRecaptchaServer(){var recaptchaResponse=$("#g-recaptcha-response").val();if(recaptchaResponse===""){return false}var itemPost=$.ajax({url:siteLocation+"includes/validate-recaptcha.php",type:"post",dataType:"html",data:{recaptcha:recaptchaResponse}});itemPost.fail(function(data,textStatus,error){console.log("Error: "+textStatus+", "+error)});itemPost.done(function(data){if(data==="success"){}if(data==="fail"){}});return itemPost}function storeRA_EV_cookie(){var cookieRAEVArray_string=JSON.stringify(cookieRAEVArray);createCookie("ac_u_ra_ev",cookieRAEVArray_string)}$.fn.serializeObject=function(){var o={};var a=this.serializeArray();$.each(a,function(){if(o[this.name]!==undefined){if(!o[this.name].push){o[this.name]=[o[this.name]]}o[this.name].push(this.value||"")}else{o[this.name]=this.value||""}});return o};$.fn.queueAddClass=function(className){this.queue("fx",function(next){$(this).addClass(className);next()});return this};$.fn.queueRemoveClass=function(className){this.queue("fx",function(next){$(this).removeClass(className);next()});return this};function scrollTo(theObject,theDuration,theOffset){if(theOffset===undefined){theOffset=0}if(document.body.clientWidth<1137){theOffset=110}if(document.body.clientWidth<837){theOffset=70}$([document.documentElement,document.body]).animate({scrollTop:theObject.offset().top-theOffset},theDuration)}$(window).on("resize",function(){resizeMunicipalityWrapper()})});function createCookie(name,value,days){var expires;if(days){var date=new Date;date.setTime(date.getTime()+days*24*60*60*1e3);expires="; expires="+date.toGMTString()}else{expires=""}document.cookie=name+"="+value+expires+"; path=/"}function getCookie(c_name){if(document.cookie.length>0){c_start=document.cookie.indexOf(c_name+"=");if(c_start!=-1){c_start=c_start+c_name.length+1;c_end=document.cookie.indexOf(";",c_start);if(c_end==-1){c_end=document.cookie.length}return unescape(document.cookie.substring(c_start,c_end))}}return""}function scramble(s,shift){var r="";for(var i=0;i<s.length;i++){r+=String.fromCharCode(s.charCodeAt(i)+shift)}return r}